<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° - Dssi Training</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@400;700&display=swap" rel="stylesheet" />
  <style>
    body {
      font-family: 'Prompt', sans-serif;
      background: linear-gradient(135deg, #fce7f3, #f6f9fb, #e0f2fe);
      min-height: 100vh;
    }
    .card {
      border: none;
      border-radius: 1rem;
      box-shadow: 0 10px 24px rgba(0, 0, 0, 0.08);
      overflow: hidden;
      background: #fff;
    }
    .card-img-top {
      height: 300px;
      object-fit: cover;
    }
    .card-title {
      font-weight: 700;
      color: #7e22ce;
    }
    .btn-primary {
      background: linear-gradient(to right, #6366f1, #ec4899);
      border: none;
      border-radius: 12px;
      font-weight: bold;
    }
    .btn-outline {
      border: 1px solid #9333ea;
      color: #9333ea;
      background-color: white;
      border-radius: 10px;
    }
    .btn-outline:hover {
      background-color: #f3e8ff;
    }
    .text-muted {
      color: #6b7280 !important;
    }
    pre.description {
      white-space: pre-wrap;
      font-size: 1rem;
      color: #444;
      background: #f9fafb;
      padding: 1rem;
      border-radius: 10px;
    }
  </style>
</head>
<body>
  <div class="container py-5">
    <div id="activityDetail" class="text-center text-muted">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCPEbltTHn_Zq44N5sABD1xokFbcviDNVU",
      authDomain: "dssi-training-91ca5.firebaseapp.com",
      projectId: "dssi-training-91ca5",
      storageBucket: "dssi-training-91ca5.appspot.com",
      messagingSenderId: "232029382209",
      appId: "1:232029382209:web:6861b0963d9fd7997b88c0"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const params = new URLSearchParams(location.search);
    const id = params.get("id");
    const activityDetail = document.getElementById("activityDetail");

    if (!id) {
      activityDetail.innerHTML = '<div class="text-danger">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</div>';
    } else {
      const docRef = doc(db, "activities", id);
      getDoc(docRef)
        .then(docSnap => {
          if (docSnap.exists()) {
            const act = docSnap.data();

            activityDetail.innerHTML = `
              <div class="card mx-auto" style="max-width: 700px;">
                <img src="${act.image || 'image/default.jpg'}" class="card-img-top" alt="${act.title}">
                <div class="card-body text-start">
                  <h3 class="card-title">${act.title}</h3>
                  <p class="text-muted mb-1">üóìÔ∏è ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏≠‡∏ö‡∏£‡∏°: ${act.date} (${act.time})</p>
                  <p class="text-muted">üìç ‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà: ${act.location || '-'}</p>
                  <pre class="description mt-3">${act.description || '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°'}</pre>
                  <div class="d-flex justify-content-between mt-4 flex-wrap gap-2">
                    <a href="index.html" class="btn btn-outline">üîô ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</a>
                    <a href="activity-register.html?id=${docSnap.id}" class="btn btn-primary">üìù ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏≠‡∏ö‡∏£‡∏°</a>
                    <button id="shareBtn" class="btn btn-outline">üì§ ‡πÅ‡∏ä‡∏£‡πå‡∏´‡∏•‡∏±‡∏Å‡∏™‡∏π‡∏ï‡∏£</button>
                  </div>
                </div>
              </div>
            `;

            // Add Web Share API after rendering
            setTimeout(() => {
              document.getElementById("shareBtn")?.addEventListener("click", async () => {
                if (navigator.share) {
                  try {
                    await navigator.share({
                      title: act.title,
                      text: `‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°: ${act.title}\n‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà ${act.date} ‡πÄ‡∏ß‡∏•‡∏≤ ${act.time}`,
                      url: window.location.href
                    });
                  } catch (err) {
                    alert("‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏ä‡∏£‡πå‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î");
                  }
                } else {
                  alert("‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏ä‡∏£‡πå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏à‡∏≤‡∏Å‡πÅ‡∏ñ‡∏ö URL ‡πÅ‡∏ó‡∏ô");
                }
              });
            }, 100);
          } else {
            activityDetail.innerHTML = '<div class="text-danger">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</div>';
          }
        })
        .catch(err => {
          console.error(err);
          activityDetail.innerHTML = '<div class="text-danger">‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</div>';
        });
    }
  </script>
</body>
</html>
